<!DOCTYPE html>
<!--
	NOTES:
	1. All tokens are represented by '$' sign in the template.
	2. You can write your code only wherever mentioned.
	3. All occurrences of existing tokens will be replaced by their appropriate values.
	4. Blank lines will be removed automatically.
	5. Remove unnecessary comments before creating your template.
-->
<html>
<head>
<meta charset="UTF-8">
<meta name="authoring-tool" content="Adobe_Animate_CC">
<title>PodCube.online</title>
<!-- write your code here -->
<style>
  #animation_container {
	position:absolute;
	margin:auto;
	left:0;right:0;
	top:0;bottom:0;
  }
</style>
<script src="https://code.createjs.com/1.0.0/createjs.min.js"></script>
<script src="PodCube.online.js?1707434087412"></script>
<script>
// Global Scripts
	// EVENTS BUS
function pubSub() {
	const subscriptions = { }
	const getNextUniqueId = getIdGenerator()
	function subscribe(eventName, callback) {
		const id = getNextUniqueId()
		if(!subscriptions[eventName]){
			subscriptions[eventName] = { }
		}
		subscriptions[eventName][id] = callback
		return {
			unsubscribe: () => {
				delete subscriptions[eventName][id]
				if (Object.keys(subscriptions[eventName]).length === 0) delete subscriptions[eventName]
			}
		}
	}
	function publish(eventName,data){
		if (!subscriptions[eventName])
			return
		Object.keys(subscriptions[eventName]).forEach(key => subscriptions[eventName][key](data))
	}
	function getIdGenerator() {
		let lastId = 0
		return function getNextUniqueId() {
			lastId += 1
			return lastId
		}
	}
	return {
		publish,
		subscribe,
	}
}
MSG = pubSub()
        /* RSS FEED PARSER & ORGANIZER
		==============================================
        ============== NOTES  ==========================
        ================================================
            * SHOULD PARSE MARKDOWN LINKS
        ===============================================*/
        const RSS_URL = "https://pinecast.com/feed/pc";
        const Transmissions = []
        //define constructor for episode
        function Episode(item) {
            // UNMODIFIED PROPERTIES
            this.guid = item.querySelector("guid").innerHTML || null;
            this.pubdate = new Date(item.querySelector("pubDate").innerHTML) || "Data Error";
            this.audio = item.querySelector("enclosure").getAttribute("url") || "Data Error";
            // ITEM DESCRIPTION FIELD
            var _d = item.querySelector("description").innerHTML;
            //MODIFIED PROPERTIES
            var _tit = item.querySelector("title").innerHTML || "Data Error";
            var _mod = lookFor(_d, "PODCUBE MODEL") || "Data Error";
            var _int = lookFor(_d, "INTEGRITY") || "Data Error";
            var _ori = lookFor(_d, "ORIGIN") || "Data Error";
            var _loc = lookFor(_d, "LOCALE") || "Data Error";
            var _reg = lookFor(_d, "REGION") || "Data Error";
            var _zon = lookFor(_d, "ZONE") || "Data Error";
            var _pla = lookFor(_d, "PLANET") || "Data Error";
            var _dat = lookFor(_d, "DATE") || "Data Error";
            var _tag = lookFor(_d, "TAGS") || "Data Error";
            //process date
            var _datParts = _dat.split("/")
            _dat = new Date(_datParts[2],_datParts[0]-1,_datParts[1])
            //process title
            _tit = _tit.match(/[a-zA-Z]+/g).join(' ')
            //process tags
            _tag = _tag.split(", ")
            //process integrity
            _int = parseFloat(_int)
            this.title = _tit
            this.model = _mod
            this.integrity = _int
            this.origin = _ori
            this.locale = _loc
            this.region = _reg
            this.zone = _zon
            this.planet = _pla
            this.date = _dat
            this.tags = _tag
            return this
        }
        function lookFor(desc, property) {
            var regex = ":: " + property + ": (.*)<\/p>"
            prop = desc.match(new RegExp(regex));
            if (prop == null) {
                return "NULL"
            } else { return prop[1] }
        }
        function getFeed() {
            fetch(RSS_URL)
                .then(response => response.text())
                .then(str => new window.DOMParser().parseFromString(str, "text/xml"))
                .then(data => {
                    const items = data.querySelectorAll("item");
                    items.forEach(el => {
                        Transmissions.push(new Episode(el))
                    })
                }
                );
        }
getFeed()
console.log(Transmissions)
// AUDIO PLAYBACK MANAGER
var nowPlaying = null;
function playAudio(src){
	if (nowPlaying == null){
		nowPlaying = new Audio();
		console.log("nowPlaying was null")
	}
console.log(src)
	nowPlaying.src = src;
	nowPlaying.load();
	nowPlaying.addEventListener("canplaythrough", (e)=>{
		//ready to play
		nowPlaying.play()
	});
}</script>
<script>
var canvas, stage, exportRoot, anim_container, dom_overlay_container, fnStartAnimation;
function init() {
	canvas = document.getElementById("canvas");
	anim_container = document.getElementById("animation_container");
	dom_overlay_container = document.getElementById("dom_overlay_container");
	var comp=AdobeAn.getComposition("46A5D1D197A275448B5D0C6F2A17AD0E");
	var lib=comp.getLibrary();
	handleComplete({},comp);
}
function handleComplete(evt,comp) {
	//This function is always called, irrespective of the content. You can use the variable "stage" after it is created in token create_stage.
	var lib=comp.getLibrary();
	var ss=comp.getSpriteSheet();
	exportRoot = new lib.PodCubeSitev2();
	stage = new lib.Stage(canvas);
	stage.enableMouseOver();	
	//Registers the "tick" event listener.
	fnStartAnimation = function() {
		stage.addChild(exportRoot);
		createjs.Ticker.framerate = lib.properties.fps;
		createjs.Ticker.addEventListener("tick", stage);
	}	    
	//Code to support hidpi screens and responsive scaling.
	AdobeAn.makeResponsive(true,'both',true,1,[canvas,anim_container,dom_overlay_container]);	
	AdobeAn.compositionLoaded(lib.properties.id);
	fnStartAnimation();
}
</script>
<!-- write your code here -->
</head>
<body onload="init();" style="margin:0px;">
	<div id="animation_container" style="background-color:rgba(23, 104, 218, 1.00); width:1920px; height:1920px">
		<canvas id="canvas" width="1920" height="1920" style="position: absolute; display: block; background-color:rgba(23, 104, 218, 1.00);"></canvas>
		<div id="dom_overlay_container" style="pointer-events:none; overflow:hidden; width:1920px; height:1920px; position: absolute; left: 0px; top: 0px; display: block;">
		</div>
	</div>
</body>
</html>